---
title: 接口定义
weight: 3
---

# 接口定义

Mock Runner使用yaml(*.yaml,*.yml)或者json(*.json)格式来定义接口，建议使用yaml格式，具有更好的可读性。


```yaml
version: v1  # 接口版本目前版本v1
kind: APIDefinition # 固定值为APIDefinition
metadata:
  name: 获取book详情 #接口名称
  labels:     # 接口标签，value值将作为swagger中的tag，支持多标签
    module: book
  annotations:   # 用于对接外部系统时的关联信息，key，value均自行定义，通过自行开发的adapter实现对接
    jira: jira-id
    feishu: fenshu-id
  description: 获取book详情 # 接口描述，作为swagger中的note信息
spec:  # 接口定义信息
  protocol: http   # 支持的协议:http, grpc,websocket,不区分大小写，加载时会转换为小写
  method: get  # 支持的方法: get,post,put,delete, 不区分大小写
  path: /api/v1/book/{id}  # 请求地址， id为path参数
  consumes: #同swagger中的consumes
  - application/json
  produces: #同swagger中的consumes
  - application/json
  socketConfig:
    waitClientMessage: false # 是否需要等待客户端发送信息，针对某些监控场景下，服务端只发送数据，客户端只接收的情况
    period: 1s  # 发送间隔
    isJson: true # 数据格式
  parameters: # 参数列表
  - in: path # 参数位置，只支持query path head
    name: id # 参数名称
    description: book id #参数描述
    type: number # 参数类型:string number bool
  cases: # 响应案例
  - condition: # 判断条件，
      simple: # 简单条件判断，若simple不为空则忽略script
        logicAnd: true # 判断条件的逻辑关系，为true则所有条件都需要成立才返回对应的响应
        items: # 判断条件项
        - valueFrom: $request.path.id # 判断值来源
          operator: = # 判断的表达式
          value: "1" # 判断值，与判断值来源作比较
      script: # 脚本判断条件
        lang: javascript # 支持的脚本: javascript, js 
        content: |- # 脚本内容，若该值不为空则忽略contentFromFile
          (function(){
          const Mock = require("mock.js");
          const res = Mock.mock({"boolean|1": true})
                      return res.boolean
                  })()
        contentFromFile: "" # 从文件中读取脚本
    response: # 响应
      simple: # 简单响应，简单响应为直接返回响应内容或者从文件中读取响应内容，若该值不为空则忽略script内容
        code: 200 # 响应码
        header: # 响应头，自行定义key和value
          header: value
        trailer: # grpc接口上使用
          key: value 
        body:
          content: '{"name":"mock-runner","author":"efcloud","price":48}'  # 响应内容，若该值不为空则忽略contentFromFile
          contentFromFile: "" # 从文件中获取响应
      script: # 脚本响应
        lang: javascript #支持的脚本: javascript, js 
        content: |- # 脚本内容，若该值不为空则忽略contentFromFile
          (function(){
                        function random(min, max){
                            return parseInt(Math.random()*(max-min+1)+min,10);
                        }
                        return {
                            code: 0,
                            header: {
                                "x-unit-id": "data",
                                "x-unit-region": "bj",
                            },
                            trailer: {
                                "x-api-version": "1.3.2",
                            },
                            body: {
                                timestamp: Math.ceil(new Date().getTime() / 1000),
                                message: "this message is generated by javascript, your request url is: " + request.url,
                                amount: random(0, 5000),
                            },
                        }
                    })()
        contentFromFile: "" # 从文件中读取脚本内容
    preProcess: "" # 请求body预处理脚本，比如数据解密
    postProcess: "" # 响应数据处理脚本，比如数据加密
```